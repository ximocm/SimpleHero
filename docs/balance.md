# Balance - MVP Spec

## Purpose
Define exact combat and economy formulas for MVP so implementation can be deterministic.

## Principles
- Keep formulas simple and explicit.
- Resolve all combat events in a fixed order.
- Use additive modifiers only in MVP.
- Avoid hidden exceptions.

## Core Combat Variables
- `Weapon Attacks`: number of `1d6` attack dice.
- `Weapon Damage`: base damage if at least 1 effective hit remains.
- `Defense Dice`: number of `1d6` defense dice rolled by defender.
- `Defense Die Result`: blocked hits generated by one defense die.
- `Blocked Hits`: total blocked hits generated by all defense dice and effects.
- `Effective Hits`: attack hits that pass defense.

## Turn Economy Rules (MVP)
Each hero turn has:
- Free movement up to `Final Movement` tiles.
- `1 Attack Slot`.
- `2 Action Points`.

### Movement
- Movement can be split into any number of segments.
- Total moved tiles in the turn cannot exceed `Final Movement`.

### Attack Slot
- Basic attack uses the `Attack Slot`.
- Spellcast uses the `Attack Slot`.
- A hero can use the `Attack Slot` at most once per turn.

### Action Points
- Utility actions cost `1 Action Point` unless another rule says otherwise.
- Utility action examples: change weapon, use consumable, help ally.

## Combat Resolution Order (MVP)
Apply this order exactly for each attack action:
1. Confirm attacker still has available `Attack Slot`.
2. Roll attack dice.
3. Convert each attack die to hit value.
4. Sum total attack hits.
5. Compute defender `Defense Dice Total = 1 + Defense Dice Bonus`.
6. Roll all defense dice.
7. Convert each defense die to blocked hits.
8. Sum blocked hits from defense dice.
9. Add temporary blocked-hit effects.
10. Compute effective hits.
11. Compute final damage.
12. Apply HP loss.
13. Consume attacker `Attack Slot`.

## 1) Attack Dice Conversion
For each `1d6` attack die:
- `1-3` => `0` hits.
- `4-5` => `1` hit.
- `6` => `2` hits.

`Total Attack Hits = sum(all converted attack dice)`

## 2) Defense Dice System
Defender rolls multiple `1d6` defense dice per incoming attack action.

`Defense Dice Total = 1 + Defense Dice Bonus`

### Defense Die Conversion
For each defense die:
- `1-3` => `0` blocked hits.
- `4-5` => `1` blocked hit.
- `6` => `2` blocked hits.

`Blocked Hits from Dice = sum(all converted defense dice)`

`Total Blocked Hits = Blocked Hits from Dice + Temporary Blocked-Hit Effects`

### Defense Dice Bonus Sources (MVP)
- Armor `Defense Dice Bonus` from equipped armor.
- Shield `Defense Dice Bonus` if equipped.

If multiple sources exist, add them directly.

### Future Defense Extension
- Future armors may also grant `Flat Damage Reduction`.
- `Flat Damage Reduction` is not active in MVP.

## 3) Effective Hits
`Effective Hits = max(0, Total Attack Hits - Total Blocked Hits)`

## 4) Final Damage
- If `Effective Hits = 0` => `Final Damage = 0`.
- If `Effective Hits >= 1`:
  - First effective hit deals full `Weapon Damage`.
  - Each additional effective hit adds `+1` damage.

`Final Damage = Weapon Damage + (Effective Hits - 1)` when `Effective Hits >= 1`.

## 5) HP Update and Defeat
- `Target HP = max(0, Target HP - Final Damage)`.
- If target HP reaches `0`, target is defeated immediately.

## 6) Healing Rule
- Healing cannot exceed max HP.
- `New HP = min(Max HP, Current HP + Heal Value)`.

## 7) Economy Values (MVP)
- Gold gained from defeated enemies is awarded after combat ends.
- Ruby value is fixed at `15` gold.
- Total account gold is updated at end of run if at least one room reward was collected.

## Balance Change Policy
- Change one numeric variable at a time.
- Record every numeric change in revision notes.
- Re-test combat with all 3 classes after each numeric update.
